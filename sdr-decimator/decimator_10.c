#include "decimator_10.h"

#define DECIMATION  10
#define FIRTAPS_NUM 63

// GNU octave: fir1(62, 0.065, 'low', 'blackman');
static const float firtaps[FIRTAPS_NUM] = {
     6.994343517986186e-21, -2.479535128454647e-06, -1.830821579540002e-05, -6.049941778785238e-05, -0.0001418371292911986,
    -0.0002734227044222104, -0.0004625817018991196, -0.0007101329457624627, -0.001007183305346261,  -0.001331782800188083,
    -0.001645924629182642,  -0.001893472697111972,  -0.001999619334884989,  -0.001872402079785179,  -0.001406637666327135,
    -0.0004903756472751869,  0.0009863405334579194,  0.003120952950528899,   0.00598696929207515,    0.009622746976717464,
     0.01402171843677327,    0.01912529050232224,    0.02481949617063784,    0.03093617853210037,    0.03725907006286044,

     0.04353463854642212,    0.04948705826572105,    0.05483619197700416,    0.05931709357326163,    0.06269931163985469,
     0.06480422252515922,    0.06551875965058349,    0.06480422252515922,    0.06269931163985469,    0.05931709357326165,
     0.05483619197700415,    0.04948705826572105,    0.04353463854642213,    0.03725907006286046,    0.03093617853210037,
     0.02481949617063784,    0.01912529050232225,    0.01402171843677328,    0.009622746976717464,   0.005986969292075148,
     0.003120952950528902,   0.0009863405334579194, -0.0004903756472751873, -0.001406637666327135,  -0.001872402079785181,

    -0.001999619334884993,  -0.001893472697111969,  -0.001645924629182642,  -0.001331782800188084,  -0.001007183305346262,
    -0.0007101329457624636, -0.0004625817018991192, -0.0002734227044222109, -0.0001418371292911983, -6.049941778785221e-05,
    -1.830821579539995e-05, -2.479535128454683e-06,  6.994343517986209e-21
};

int decimator_10(struct _complexf *output, const struct _complexf *input, int *remain) {
    int i, oi;
    for(i=0, oi=0; i < BUFSIZE-FIRTAPS_NUM+1; i+=DECIMATION) {
	int ti;
	struct _complexf acc = {0, 0};
	for(ti=0; ti<FIRTAPS_NUM; ti++) {
	    acc.i += input[i+ti].i * firtaps[ti];
	    acc.q += input[i+ti].q * firtaps[ti];
	}
	output[oi++]=acc;
    }
    *remain = BUFSIZE-i;
    return oi;
}
